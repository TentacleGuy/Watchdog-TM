let MAX_CONTROLLER_TIME=30,inQueue=!1,isController=!1,queuePosition=0,totalInQueue=0,controllerTimeLeft=0,controllerTimeInterval=null,estimatedWaitTime=0;function joinQueue(){window.sharedSocket.emit("joinQueue"),inQueue=!0,updateQueueDisplay()}function leaveQueue(){window.sharedSocket.emit("leaveQueue"),inQueue=!1,updateQueueDisplay()}function toggleLight(e){e&&e.stopPropagation(),window.sharedSocket.emit("toggleLight")}function updateBatteryDisplay(e){var t=document.getElementById("battery-text"),o=document.getElementById("battery-indicator");t.textContent=e+"%";let n;n=e<=20?"#f0506e":e<=50?"#faa05a":"#32d296",o.style.color=n}function updateLightStatus(e){var t=document.getElementById("light-toggle");e?(t.classList.remove("light-off"),t.classList.add("light-on")):(t.classList.remove("light-on"),t.classList.add("light-off"))}function updateOnlineStatus(e){var t=document.getElementById("statusIndicator"),o=document.getElementById("robot_status");e?(t.style.color="#32d296",o.textContent="online"):(t.style.color="#f0506e",o.textContent="offline")}function updateQueueDisplay(){var e=document.getElementById("queue-position"),t=document.getElementById("position"),o=document.getElementById("total-queue"),n=document.getElementById("controller-status"),l=document.getElementById("join-queue-btn"),i=document.getElementById("leave-queue-btn"),a=document.getElementById("current-controller-time"),d=document.getElementById("estimated-wait-time");isController?(n.textContent="You are in control",n.style.color="#32d296",e.classList.add("hidden"),l.classList.add("hidden"),i.classList.remove("hidden"),a.classList.remove("hidden"),d.classList.add("hidden")):inQueue?(n.textContent="You are in queue",n.style.color="#faa05a",e.classList.remove("hidden"),t.textContent=queuePosition,o.textContent=totalInQueue,l.classList.add("hidden"),i.classList.remove("hidden"),a.classList.remove("hidden"),d.classList.remove("hidden"),document.getElementById("wait-time").textContent=estimatedWaitTime):(n.textContent="You are not in control",n.style.color="#999",e.classList.add("hidden"),l.classList.remove("hidden"),i.classList.add("hidden"),a.classList.remove("hidden"),d.classList.add("hidden")),document.getElementById("controller-time-left").textContent=controllerTimeLeft}function startControllerTimeCountdown(){controllerTimeInterval&&clearInterval(controllerTimeInterval),controllerTimeInterval=setInterval(()=>{0<controllerTimeLeft&&(controllerTimeLeft--,updateQueueDisplay(),inQueue)&&!isController&&(estimatedWaitTime=Math.max(0,(queuePosition-1)*MAX_CONTROLLER_TIME+controllerTimeLeft),updateQueueDisplay())},6e4)}window.sharedSocket=io(),window.sharedSocket.on("connect",()=>{console.log("Connected to server")}),window.sharedSocket.on("esp_ip",e=>{console.log("Received ESP IP:",e),document.getElementById("robot_ip").textContent=e}),window.sharedSocket.on("robot_data",e=>{updateOnlineStatus(!0),updateLightStatus(e.light);var t=new Date;document.getElementById("robot_last_seen").textContent=t.toLocaleTimeString(),void 0!==e.battery&&updateBatteryDisplay(e.battery),document.getElementById("output").value=JSON.stringify(e,null,2)}),window.sharedSocket.on("queuePosition",e=>{console.log("Queue position:",e),inQueue=!0,queuePosition=e,updateQueueDisplay()}),window.sharedSocket.on("queueTotal",e=>{console.log("Queue total:",e),totalInQueue=e,updateQueueDisplay()}),window.sharedSocket.on("controllerStatus",e=>{console.log("Controller status:",e),isController=e.isController,controllerTimeLeft=e.timeLeft,e.isController&&(inQueue=!1),updateQueueDisplay(),startControllerTimeCountdown(),inQueue&&!isController&&(estimatedWaitTime=Math.max(0,(queuePosition-1)*MAX_CONTROLLER_TIME+controllerTimeLeft),updateQueueDisplay())}),window.sharedSocket.on("disconnect",()=>{updateOnlineStatus(!1),controllerTimeInterval&&(clearInterval(controllerTimeInterval),controllerTimeInterval=null)}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("join-queue-btn").addEventListener("click",joinQueue),document.getElementById("leave-queue-btn").addEventListener("click",leaveQueue),document.getElementById("light-toggle").addEventListener("click",e=>{toggleLight(e)}),updateOnlineStatus(!1),updateBatteryDisplay(0),updateLightStatus(!1),updateQueueDisplay()});